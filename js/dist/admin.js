(()=>{var t={n:s=>{var a=s&&s.__esModule?()=>s.default:()=>s;return t.d(a,{a}),a},d:(s,a)=>{for(var i in a)t.o(a,i)&&!t.o(s,i)&&Object.defineProperty(s,i,{enumerable:!0,get:a[i]})},o:(t,s)=>Object.prototype.hasOwnProperty.call(t,s)};(()=>{"use strict";const s=flarum.core.compat.app;var a=t.n(s);function i(t,s){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,s){return t.__proto__=s,t},i(t,s)}function e(t,s){t.prototype=Object.create(s.prototype),t.prototype.constructor=t,i(t,s)}const n=flarum.core.compat["admin/app"];var r=t.n(n);const l=flarum.core.compat["admin/components/ExtensionPage"];var o=t.n(l);const d=flarum.core.compat["admin/components/UploadImageButton"];var g=t.n(d);function c(t){return!!app.data.extensions.hasOwnProperty(t)}function u(t){return!!app.data.settings.extensions_enabled.includes(t)}const p=flarum.core.compat["common/helpers/icon"];var _=t.n(p),h=function(t){function s(){return t.apply(this,arguments)||this}e(s,t);var a=s.prototype;return a.content=function(){var t="flarumite-simple-discussion-views",s="michaelbelgium-discussion-views",a="v17development-blog",i="shebaoting-repost",e=_()("fas fa-exclamation-triangle");return m("div",{className:"DiscussionCardsSettings"},m("div",{className:"container"},m("div",{className:"DiscussionCardsSettings--content"},m("h3",null,r().translator.trans("walsgit_discussion_cards.admin.settings.general.where_title")),m("p",{className:"helpText"},r().translator.trans("walsgit_discussion_cards.admin.settings.general.where_info")),m("div",{className:"Section"},this.buildSettingComponent({type:"flarum-tags.select-tags",setting:"walsgit_discussion_cards_allowedTags",label:r().translator.trans("walsgit_discussion_cards.admin.settings.general.allowedTags_label"),help:r().translator.trans("walsgit_discussion_cards.admin.settings.general.allowedTags_help"),options:{requireParentTag:!1}}),this.buildSettingComponent({type:"switch",setting:"walsgit_discussion_cards_onIndexPage",label:r().translator.trans("walsgit_discussion_cards.admin.settings.general.onIndexPage_label"),help:r().translator.trans("walsgit_discussion_cards.admin.settings.general.onIndexPage_help")})),m("h3",null,r().translator.trans("walsgit_discussion_cards.admin.settings.general.primaryCardOptions_title")),m("p",{className:"helpText"},r().translator.trans("walsgit_discussion_cards.admin.settings.general.primaryCardOptions_info")),m("div",{className:"Section"},this.buildSettingComponent({type:"number",className:"DC-Number",setting:"walsgit_discussion_cards_primaryCards",label:r().translator.trans("walsgit_discussion_cards.admin.settings.general.primaryCards_label"),help:r().translator.trans("walsgit_discussion_cards.admin.settings.general.primaryCards_help"),min:0,step:1,placeholder:4}),this.buildSettingComponent({type:"number",className:"DC-Number",setting:"walsgit_discussion_cards_desktopCardWidth",label:r().translator.trans("walsgit_discussion_cards.admin.settings.general.desktopCardWidth_label"),help:r().translator.trans("walsgit_discussion_cards.admin.settings.general.desktopCardWidth_help"),min:10,max:100,step:1,placeholder:49}),this.buildSettingComponent({type:"number",className:"DC-Number",setting:"walsgit_discussion_cards_tabletCardWidth",label:r().translator.trans("walsgit_discussion_cards.admin.settings.general.tabletCardWidth_label"),help:r().translator.trans("walsgit_discussion_cards.admin.settings.general.tabletCardWidth_help"),min:10,max:100,step:1,placeholder:49})),m("h3",null,r().translator.trans("walsgit_discussion_cards.admin.settings.general.cardOptions_title")),m("p",{className:"helpText"},r().translator.trans("walsgit_discussion_cards.admin.settings.general.cardOptions_info")),m("div",{className:"Section"},m("div",{className:"DC-DefaultImageSettings"},m("h4",null,r().translator.trans("walsgit_discussion_cards.admin.settings.general.defaultImage_title")),m("p",{className:"helpText"},r().translator.trans("walsgit_discussion_cards.admin.settings.general.defaultImage_info")),null===r().forum.attribute("walsgitDiscussionCardsDefaultImage")?m("div",{className:"imgStub"}):m("img",{className:"DC-UserUploadedImage",src:r().forum.attribute("baseUrl")+"/assets/"+r().forum.attribute("walsgitDiscussionCardsDefaultImage")}),m(g(),{name:"walsgit_discussion_cards_default_image",class:"DC-UploadImageBtn"})),this.buildSettingComponent({type:"switch",setting:"walsgit_discussion_cards_previewText",label:r().translator.trans("walsgit_discussion_cards.admin.settings.general.previewText_label"),help:r().translator.trans("walsgit_discussion_cards.admin.settings.general.previewText_help")}),this.buildSettingComponent({type:"switch",setting:"walsgit_discussion_cards_showAuthor",label:r().translator.trans("walsgit_discussion_cards.admin.settings.general.showAuthor_label"),help:r().translator.trans("walsgit_discussion_cards.admin.settings.general.showAuthor_help")}),this.buildSettingComponent({type:"switch",setting:"walsgit_discussion_cards_showReplies",label:r().translator.trans("walsgit_discussion_cards.admin.settings.general.showReplies_label"),help:r().translator.trans("walsgit_discussion_cards.admin.settings.general.showReplies_help")}),this.buildSettingComponent({type:"switch",setting:"walsgit_discussion_cards_showRepliesOnRight",label:r().translator.trans("walsgit_discussion_cards.admin.settings.general.showRepliesOnRight_label"),help:r().translator.trans("walsgit_discussion_cards.admin.settings.general.showRepliesOnRight_help")}),this.buildSettingComponent({type:"switch",setting:"walsgit_discussion_cards_showLastPostInfo",label:r().translator.trans("walsgit_discussion_cards.admin.settings.general.showLastPostInfo_label"),help:r().translator.trans("walsgit_discussion_cards.admin.settings.general.showLastPostInfo_help")}),this.buildSettingComponent({type:"switch",setting:"walsgit_discussion_cards_showBadges",label:r().translator.trans("walsgit_discussion_cards.admin.settings.general.showBadges_label"),help:r().translator.trans("walsgit_discussion_cards.admin.settings.general.showBadges_help")}),this.buildSettingComponent({type:"switch",setting:"walsgit_discussion_cards_markReadCards",label:r().translator.trans("walsgit_discussion_cards.admin.settings.general.markReadCards_label"),help:r().translator.trans("walsgit_discussion_cards.admin.settings.general.markReadCards_help")})),m("h3",null,r().translator.trans("walsgit_discussion_cards.admin.settings.general.otherOptions_title")),m("p",{className:"helpText"},r().translator.trans("walsgit_discussion_cards.admin.settings.general.otherOptions_info")),m("div",{className:"Section"},m("h4",null,r().translator.trans("walsgit_discussion_cards.admin.settings.general.showViews_title_start"),m("a",{href:"https://flarum.org/extension/flarumite/simple-discussion-views",target:"_blank",rel:"noopener noreferrer"},"Flarumite Simple Discussion Views"),r().translator.trans("walsgit_discussion_cards.admin.settings.general.showViews_title_or"),m("a",{href:"https://flarum.org/extension/michaelbelgium/flarum-discussion-views",target:"_blank",rel:"noopener noreferrer"},"michaelbelgium/flarum-discussion-views"),r().translator.trans("walsgit_discussion_cards.admin.settings.general.showViews_title_end")),m("div",{className:"helpText"},m("em",null,c(t)||c(s)?c(t)&&!u(t)||c(s)&&!u(s)?r().translator.trans("walsgit_discussion_cards.admin.settings.general.viewsExtension_notActivated",{icon:e}):"":r().translator.trans("walsgit_discussion_cards.admin.settings.general.viewsExtension_notInstalled",{icon:e}))),this.buildSettingComponent({type:"switch",setting:"walsgit_discussion_cards_showViews",label:r().translator.trans("walsgit_discussion_cards.admin.settings.general.showViews_label"),help:r().translator.trans("walsgit_discussion_cards.admin.settings.general.showViews_help"),disabled:!u(t)&&!u(s)}),m("hr",null),m("h4",null,r().translator.trans("walsgit_discussion_cards.admin.settings.general.blogExtension_title_start"),m("a",{href:"https://flarum.org/extension/v17development/flarum-blog",target:"_blank",rel:"noopener noreferrer"},"Flarum Blog"),r().translator.trans("walsgit_discussion_cards.admin.settings.general.blogExtension_title_end")),m("div",{className:"helpText"},m("em",null,c(a)?u(a)?"":r().translator.trans("walsgit_discussion_cards.admin.settings.general.blogExtension_notActivated",{icon:e}):r().translator.trans("walsgit_discussion_cards.admin.settings.general.blogExtension_notInstalled",{icon:e}))),this.buildSettingComponent({type:"switch",setting:"walsgit_discussion_cards_useBlogImages",label:r().translator.trans("walsgit_discussion_cards.admin.settings.general.useBlogImages_label"),help:r().translator.trans("walsgit_discussion_cards.admin.settings.general.useBlogImages_help"),disabled:!u(a)}),this.buildSettingComponent({type:"switch",setting:"walsgit_discussion_cards_useBlogSummary",label:r().translator.trans("walsgit_discussion_cards.admin.settings.general.useBlogSummary_label"),help:r().translator.trans("walsgit_discussion_cards.admin.settings.general.useBlogSummary_help"),disabled:!u(a)}),m("hr",null),m("h4",null,r().translator.trans("walsgit_discussion_cards.admin.settings.general.repostExtension_title_start"),m("a",{href:"https://flarum.org/extension/shebaoting/repost",target:"_blank",rel:"noopener noreferrer"},"Repost"),r().translator.trans("walsgit_discussion_cards.admin.settings.general.repostExtension_title_end")),m("div",{className:"helpText"},m("em",null,c(i)?u(i)?"":r().translator.trans("walsgit_discussion_cards.admin.settings.general.repostExtension_notActivated",{icon:e}):r().translator.trans("walsgit_discussion_cards.admin.settings.general.repostExtension_notInstalled",{icon:e}))),this.buildSettingComponent({type:"switch",setting:"walsgit_discussion_cards_allowRepostLinks",label:r().translator.trans("walsgit_discussion_cards.admin.settings.general.allowRepostLinks_label"),help:r().translator.trans("walsgit_discussion_cards.admin.settings.general.allowRepostLinks_help"),disabled:!u(i)})),this.submitButton())))},a.onsubmit=function(){var t=Number(this.setting("walsgit_discussion_cards_primaryCards")()),s=Number(this.setting("walsgit_discussion_cards_desktopCardWidth")()),a=Number(this.setting("walsgit_discussion_cards_tabletCardWidth")());return t<0||isNaN(t)?(r().alerts.show({type:"error"},r().translator.trans("walsgit_discussion_cards.admin.errors.primaryCards")),!1):s<10||s>100||isNaN(s)?(r().alerts.show({type:"error"},r().translator.trans("walsgit_discussion_cards.admin.errors.desktopCardWidth")),!1):!(a<10||a>100||isNaN(a))||(r().alerts.show({type:"error"},r().translator.trans("walsgit_discussion_cards.admin.errors.tabletCardWidth")),!1)},a.saveSettings=function(s){if(this.onsubmit()){var a=this.dirty();t.prototype.saveSettings.call(this,s).then((function(){var t={};for(var s in a){var i=s.replace("walsgit_discussion_cards_","");t["walsgitDiscussionCards"+(i=i.replace(/^./,i.charAt(0).toUpperCase()))]=a[s]}r().forum.pushAttributes(t)})).catch((function(t){console.error(t)}))}},s}(o());const w=flarum.core.compat.extend,b=flarum.core.compat["common/Model"];var f=t.n(b);const C=flarum.core.compat["common/components/Button"];var y=t.n(C);const v=flarum.core.compat["tags/models/Tag"];var S=t.n(v);const N=flarum.core.compat["tags/components/EditTagModal"];var D=t.n(N);const T=flarum.core.compat["common/components/Modal"];var W=t.n(T);const x=flarum.core.compat["common/utils/Stream"];var I=t.n(x),k={},O=function(t){function s(){return t.apply(this,arguments)||this}e(s,t);var a=s.prototype;return a.oninit=function(s){t.prototype.oninit.call(this,s),this.tagSettings=JSON.parse(this.attrs.model.data.attributes.walsgitDiscussionCardsTagSettings||null)||{},k={primaryCards:app.forum.data.attributes.walsgitDiscussionCardsPrimaryCards,desktopCardWidth:app.forum.data.attributes.walsgitDiscussionCardsDesktopCardWidth,tabletCardWidth:app.forum.data.attributes.walsgitDiscussionCardsTabletCardWidth},this.tagSettings.hasOwnProperty("primaryCards")&&null!==this.tagSettings.primaryCards||(this.tagSettings.primaryCards=k.primaryCards),this.tagSettings.hasOwnProperty("desktopCardWidth")&&null!==this.tagSettings.desktopCardWidth||(this.tagSettings.desktopCardWidth=k.desktopCardWidth),this.tagSettings.hasOwnProperty("tabletCardWidth")&&null!==this.tagSettings.tabletCardWidth||(this.tagSettings.tabletCardWidth=k.tabletCardWidth),this.tagSettings.primaryCards=I()(this.tagSettings.primaryCards),this.tagSettings.desktopCardWidth=I()(this.tagSettings.desktopCardWidth),this.tagSettings.tabletCardWidth=I()(this.tagSettings.tabletCardWidth)},a.className=function(){return"WdcTagSettingsModal Modal--large"},a.title=function(){return[app.translator.trans("walsgit_discussion_cards.admin.tag_modal.title"),m("span",{className:"TagLabel colored",style:"--tag-bg: "+this.attrs.model.data.attributes.color+";"},m("span",{className:"TagLabel-text"},m("span",{className:"TagLabel-name"},this.attrs.model.data.attributes.name)))]},a.content=function(){return[m("div",{className:"Modal-body"},m("div",{className:"Form"},m("p",null,app.translator.trans("walsgit_discussion_cards.admin.tag_modal.intro_text")),m("div",{className:"Form-group"},m("label",{htmlFor:"primaryCards"},app.translator.trans("walsgit_discussion_cards.admin.tag_modal.primaryCards_label")),m("div",{className:"helpText"},app.translator.trans("walsgit_discussion_cards.admin.tag_modal.primaryCards_help",{default:k.primaryCards})),m("input",{type:"number",name:"primaryCards",className:"FormControl DC-Number",bidi:this.tagSettings.primaryCards})),m("div",{className:"Form-group"},m("label",{htmlFor:"desktopCardWidth"},app.translator.trans("walsgit_discussion_cards.admin.tag_modal.desktopCardWidth_label")),m("div",{className:"helpText"},app.translator.trans("walsgit_discussion_cards.admin.tag_modal.desktopCardWidth_help",{default:k.desktopCardWidth})),m("input",{type:"number",name:"desktopCardWidth",className:"FormControl DC-Number",bidi:this.tagSettings.desktopCardWidth})),m("div",{className:"Form-group"},m("label",{htmlFor:"tabletCardWidth"},app.translator.trans("walsgit_discussion_cards.admin.tag_modal.tabletCardWidth_label")),m("div",{className:"helpText"},app.translator.trans("walsgit_discussion_cards.admin.tag_modal.tabletCardWidth_help",{default:k.tabletCardWidth})),m("input",{type:"number",name:"tabletCardWidth",className:"FormControl DC-Number",bidi:this.tagSettings.tabletCardWidth})),m(y(),{type:"submit",className:"Button Button--primary",loading:this.loading,disabled:this.changed()},app.translator.trans("walsgit_discussion_cards.admin.tag_modal.submit_button"))))]},a.changed=function(){var t=JSON.parse(this.attrs.model.data.attributes.walsgitDiscussionCardsTagSettings||"null")||{};return function(t,s){if("object"!=typeof t||"object"!=typeof s)return!1;if(Object.keys(t).length!==Object.keys(s).length)return!1;for(var a in t)if(t.hasOwnProperty(a))if("object"==typeof t[a]&&"object"==typeof s[a]){if(!compareObjects(t[a],s[a]))return!1}else if(t[a]!==s[a])return!1;return!0}(JSON.parse(JSON.stringify(this.tagSettings)),t)},a.onsubmit=function(t){t.preventDefault();var s=parseInt(this.tagSettings.primaryCards());if(isNaN(s)||s<0)app.alerts.show({type:"error"},app.translator.trans("walsgit_discussion_cards.admin.errors.primaryCards"));else{var a=parseInt(this.tagSettings.desktopCardWidth());if(isNaN(a)||a<10||a>100)app.alerts.show({type:"error"},app.translator.trans("walsgit_discussion_cards.admin.errors.desktopCardWidth"));else{var i=parseInt(this.tagSettings.tabletCardWidth());if(isNaN(i)||i<10||i>100)app.alerts.show({type:"error"},app.translator.trans("walsgit_discussion_cards.admin.errors.tabletCardWidth"));else{var e=this.attrs.model;this.tagSettings.primaryCards(s),this.tagSettings.desktopCardWidth(a),this.tagSettings.tabletCardWidth(i);var n=JSON.stringify(this.tagSettings);this.loading=!0,app.request({method:"PATCH",url:app.forum.attribute("apiUrl")+"/tags/"+e.id()+"/tagSettings",body:{data:{tagSettings:n}}}).then((function(){e.data.attributes.walsgitDiscussionCardsTagSettings=n,app.modal.close()}))}}}},s}(W());function B(){return B=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var a=arguments[s];for(var i in a)({}).hasOwnProperty.call(a,i)&&(t[i]=a[i])}return t},B.apply(null,arguments)}const P=flarum.core.compat["common/utils/classList"];var R=t.n(P),A=function(t){function s(s){var a;return(a=t.call(this,s)||this).loading=!1,a.tagId=s.attrs.tagId,a}e(s,t);var a=s.prototype;return a.view=function(s){return this.attrs.loading=this.loading,this.attrs.className=R()(this.attrs.className,"Button"),r().store.data.tags[this.tagId].data.attributes.walsgitDiscussionCardsTagDefaultImage?(this.attrs.onclick=this.remove.bind(this),m("div",null,m("p",null,m("img",{className:"DC-TagDefaultImage",src:"assets/"+r().store.data.tags[this.tagId].data.attributes.walsgitDiscussionCardsTagDefaultImage,alt:"",width:"200px"})),m("p",null,t.prototype.view.call(this,B({},s,{children:r().translator.trans("core.admin.upload_image.remove_button")}))))):(this.attrs.onclick=this.upload.bind(this),t.prototype.view.call(this,B({},s,{children:r().translator.trans("core.admin.upload_image.upload_button")})))},a.upload=function(){var t=this;this.loading||$('<input type="file">').appendTo("body").hide().trigger("click").on("change",(function(s){var a=new FormData;a.append(t.attrs.name,$(s.target)[0].files[0]),a.append("tagId",t.tagId),t.loading=!0,m.redraw(),r().request({method:"POST",url:t.resourceUrl(),serialize:function(t){return t},body:a}).then(t.success.bind(t),t.failure.bind(t))}))},a.remove=function(){this.loading=!0,m.redraw();var t=new FormData;t.append("tagId",this.tagId),r().request({method:"DELETE",url:this.resourceUrl(),body:t}).then(this.success.bind(this),this.failure.bind(this))},a.resourceUrl=function(){return r().forum.attribute("apiUrl")+"/"+this.attrs.name},a.success=function(t){window.location.reload()},a.failure=function(t){this.loading=!1,m.redraw()},s}(y());a().initializers.add("walsgit/discussion-cards",(function(){S().prototype.WdcDefaultImage=f().attribute("walsgit_discussion_cards_tag_default_image"),(0,w.extend)(D().prototype,"fields",(function(t){var s=this;if(this.tag.id()){var i=JSON.parse(a().forum.attribute("walsgitDiscussionCardsAllowedTags")),e=i.includes(this.tag.id()),n=e?"DC-ActivationBtn Button activated":"DC-ActivationBtn Button Button--primary",r=e?"DC-TagSettings":"DC-TagSettings DC-Hidden",l=e?a().translator.trans("walsgit_discussion_cards.admin.tags.deactivation_button"):a().translator.trans("walsgit_discussion_cards.admin.tags.activation_button");t.add("tag-discussion-cards-options",m("fieldset",{className:"DC-Fieldset"},m("legend",null,a().translator.trans("walsgit_discussion_cards.admin.tags.options_heading")),m(y(),{className:n,icon:"fas fa-border-all",onclick:function(){(e=!e)?i.push(s.tag.id()):i=i.filter((function(t){return t!==s.tag.id()})),a().request({method:"POST",url:a().forum.attribute("apiUrl")+"/walsgit_discussion_cards_tag_update_allowedTags",body:{allowedTags:i}}).then((function(){a().forum.data.attributes.walsgitDiscussionCardsAllowedTags=JSON.stringify(i),a().data.settings.walsgit_discussion_cards_allowedTags=JSON.stringify(i),n=(e=!e)?"DC-ActivationBtn Button activated":"DC-ActivationBtn Button Button--primary",r=e?"DC-TagSettings":"DC-TagSettings DC-Hidden",l=e?a().translator.trans("walsgit_discussion_cards.admin.tags.deactivation_button"):a().translator.trans("walsgit_discussion_cards.admin.tags.activation_button"),m.redraw()}))}},l),m("div",{className:r},m("div",{className:"DC-TagDefaultImageSettings"},m("h4",null,a().translator.trans("walsgit_discussion_cards.admin.tags.defaultImage_title")),m("p",{className:"helpText"},a().translator.trans("walsgit_discussion_cards.admin.tags.defaultImage_info")),m(A,{name:"walsgit_discussion_cards_tag_default_image",className:"DC-UploadTagImageBtn",ariaLabel:"Upload a default image for this tag",tagId:this.tag.id()})),m(y(),{className:"Button Button--primary",icon:"fas fa-border-all",onclick:function(){a().modal.show(O,{model:s.tag})}},a().translator.trans("walsgit_discussion_cards.admin.tags.options_button")))),-20)}})),a().extensionData.for("walsgit-discussion-cards").registerPage(h)}))})(),module.exports={}})();
//# sourceMappingURL=admin.js.map