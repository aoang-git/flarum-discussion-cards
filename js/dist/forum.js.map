{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@walsgit/flarum-discussion-cards/webpack/bootstrap","webpack://@walsgit/flarum-discussion-cards/webpack/runtime/compat get default export","webpack://@walsgit/flarum-discussion-cards/webpack/runtime/define property getters","webpack://@walsgit/flarum-discussion-cards/webpack/runtime/hasOwnProperty shorthand","webpack://@walsgit/flarum-discussion-cards/external root \"flarum.core.compat['app']\"","webpack://@walsgit/flarum-discussion-cards/external root \"flarum.core.compat['extend']\"","webpack://@walsgit/flarum-discussion-cards/external root \"flarum.core.compat['forum/components/DiscussionList']\"","webpack://@walsgit/flarum-discussion-cards/external root \"flarum.core.compat['forum/states/DiscussionListState']\"","webpack://@walsgit/flarum-discussion-cards/external root \"flarum.core.compat['forum/components/IndexPage']\"","webpack://@walsgit/flarum-discussion-cards/external root \"flarum.core.compat['common/components/LoadingIndicator']\"","webpack://@walsgit/flarum-discussion-cards/external root \"flarum.core.compat['common/components/Placeholder']\"","webpack://@walsgit/flarum-discussion-cards/external root \"flarum.core.compat['common/components/Button']\"","webpack://@walsgit/flarum-discussion-cards/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@walsgit/flarum-discussion-cards/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@walsgit/flarum-discussion-cards/external root \"flarum.core.compat['common/Component']\"","webpack://@walsgit/flarum-discussion-cards/external root \"flarum.core.compat['common/helpers/icon']\"","webpack://@walsgit/flarum-discussion-cards/external root \"flarum.core.compat['common/components/Tooltip']\"","webpack://@walsgit/flarum-discussion-cards/./src/forum/utils/craftBadges.js","webpack://@walsgit/flarum-discussion-cards/./src/forum/helpers/isValideImageUrl.js","webpack://@walsgit/flarum-discussion-cards/./src/forum/helpers/highlightHashtags.js","webpack://@walsgit/flarum-discussion-cards/external root \"flarum.core.compat['common/components/Link']\"","webpack://@walsgit/flarum-discussion-cards/external root \"flarum.core.compat['tags/utils/sortTags']\"","webpack://@walsgit/flarum-discussion-cards/./src/forum/utils/craftTags.js","webpack://@walsgit/flarum-discussion-cards/external root \"flarum.core.compat['common/utils/humanTime']\"","webpack://@walsgit/flarum-discussion-cards/external root \"flarum.core.compat['common/helpers/username']\"","webpack://@walsgit/flarum-discussion-cards/external root \"flarum.core.compat['common/components/Dropdown']\"","webpack://@walsgit/flarum-discussion-cards/external root \"flarum.core.compat['forum/utils/DiscussionControls']\"","webpack://@walsgit/flarum-discussion-cards/external root \"flarum.core.compat['common/utils/string']\"","webpack://@walsgit/flarum-discussion-cards/external root \"flarum.core.compat['common/helpers/avatar']\"","webpack://@walsgit/flarum-discussion-cards/./src/forum/components/LastReplies.js","webpack://@walsgit/flarum-discussion-cards/./src/forum/helpers/compareTags.js","webpack://@walsgit/flarum-discussion-cards/external root \"flarum.core.compat['components/TerminalPost']\"","webpack://@walsgit/flarum-discussion-cards/./src/forum/components/CardItem.js","webpack://@walsgit/flarum-discussion-cards/./src/forum/helpers/getPostImage.js","webpack://@walsgit/flarum-discussion-cards/external root \"flarum.core.compat['common/utils/abbreviateNumber']\"","webpack://@walsgit/flarum-discussion-cards/./src/forum/components/ListItem.js","webpack://@walsgit/flarum-discussion-cards/./src/forum/helpers/getPostImages.js","webpack://@walsgit/flarum-discussion-cards/./src/forum/helpers/checkOverflowingTags.js","webpack://@walsgit/flarum-discussion-cards/./src/forum/compat.js","webpack://@walsgit/flarum-discussion-cards/external assign \"flarum.core\"","webpack://@walsgit/flarum-discussion-cards/./src/forum/index.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionList'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/states/DiscussionListState'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/IndexPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/LoadingIndicator'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Placeholder'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","function _setPrototypeOf(t, e) {\n  return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {\n    return t.__proto__ = e, t;\n  }, _setPrototypeOf(t, e);\n}\nexport { _setPrototypeOf as default };","import setPrototypeOf from \"./setPrototypeOf.js\";\nfunction _inheritsLoose(t, o) {\n  t.prototype = Object.create(o.prototype), t.prototype.constructor = t, setPrototypeOf(t, o);\n}\nexport { _inheritsLoose as default };","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Component'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/icon'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Tooltip'];","import icon from 'flarum/common/helpers/icon';\nimport Tooltip from 'flarum/common/components/Tooltip';\n\nexport default function craftBadges(badges) {\n  if (badges.length) {\n    return [m('.cardBadges', [badges.map((badge) => {\n      return [\n        m(Tooltip, {\n          text: badge.attrs.label ? badge.attrs.label[0] : '',\n          position: 'right'\n        },\n        m('span.cardBadge.Badge.Badge--' + badge.attrs.type, [icon(badge.attrs.icon)]))]\n    })])];\n  }\n};\n","export default function isValideImageUrl (url) {\n    if(typeof url !== 'string') return false;\n    \n    const imageExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp', 'bmp', 'svg'];\n\n    if (!url.startsWith('http://') && !url.startsWith('https://')) {\n        url = 'http://' + url;\n    }\n\n    let parsedUrl;\n    try {\n        parsedUrl = new URL(url);\n    } catch {\n        return false;\n    }\n\n    const extension = parsedUrl.pathname.split('.').pop().toLowerCase();\n    return imageExtensions.includes(extension);\n}","/**\r\n * 高亮显示文本中的 #标签 和 电话号码\r\n * @param {string} text - 原始文本\r\n * @returns {string} - 包含HTML标记的文本\r\n */\r\nexport default function highlightHashtags(text) {\r\n  if (!text) return '';\r\n  \r\n  // HTML转义，防止XSS\r\n  const escapeHtml = (str) => {\r\n    return str\r\n      .replace(/&/g, '&amp;')\r\n      .replace(/</g, '&lt;')\r\n      .replace(/>/g, '&gt;')\r\n      .replace(/\"/g, '&quot;')\r\n      .replace(/'/g, '&#039;');\r\n  };\r\n  \r\n  const escaped = escapeHtml(text);\r\n  \r\n  // 先匹配电话号码（11位连续数字，前后不能是数字）\r\n  // 使用负向前瞻和负向后顾确保不是更长数字的一部分\r\n  const phoneRegex = /(?<!\\d)(\\d{11})(?!\\d)/g;\r\n  let result = escaped.replace(phoneRegex, '<span class=\"hashtag\">$1</span>');\r\n  \r\n  // 再匹配 #标签（#开头，到空格、标点或结尾）\r\n  // 支持中英文、数字、下划线\r\n  const hashtagRegex = /#([^\\s#<>，。！？、；：\"\"''（）]+)/g;\r\n  result = result.replace(hashtagRegex, '<span class=\"hashtag\">#$1</span>');\r\n  \r\n  return result;\r\n}\r\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Link'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['tags/utils/sortTags'];","import Link from 'flarum/common/components/Link';\nimport sortTags from 'flarum/tags/utils/sortTags';\n\nexport default function craftTags(tags) {\n  if (tags) {\n    return [sortTags(tags).map(function (tag) {\n      return [\n        <Link className=\"cardTag\"\n              style={{backgroundColor: tag.color()}}\n              href={app.route('tag', {tags: tag.slug()})}>\n          {tag.name()}\n        </Link>\n      ]\n    })];\n  }\n};\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/humanTime'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/username'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Dropdown'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/utils/DiscussionControls'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/string'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/avatar'];","import Component from 'flarum/common/Component';\nimport avatar from 'flarum/common/helpers/avatar';\n\n\nexport default class LastReplies extends Component {\n\n  oninit(vnode) {\n    super.oninit(vnode);\n    this.discussion = this.attrs.discussion;\n  }\n\n  view() {\n    const discussion = this.discussion;\n\n    // let's assume that the last 10 posts will be enough for us to identify 3 unique users\n    const posts = discussion.posts().splice(-10);\n\n    const filteredPosts = posts\n      .filter((post) => {\n        return !post.isHidden() && post.number() !== 1 && post.contentType() === \"comment\";\n      })\n      .sort((a, b) => b.createdAt() - a.createdAt());\n\n    const groupedUsers = filteredPosts\n      .map(post => post.user())\n      .filter((user, i, self) => {\n        return self.indexOf(user) === i\n      })\n      .reverse()\n      // last 3 users\n      .splice(-3);\n\n\n    return groupedUsers.map(user => {\n      return avatar(user, {className: 'Avatar--mini'})\n    })\n\n  }\n\n}\n","export default function compareTags(currentTag, priorityTag) {\n    if (currentTag.isChild && !priorityTag.isChild) return -1;\n    if (!currentTag.isChild && priorityTag.isChild) return 1;\n    if (currentTag.isChild && priorityTag.isChild && currentTag.parent === priorityTag.parent) return currentTag.position - priorityTag.position;\n    if (currentTag.isChild && priorityTag.isChild && currentTag.parent !== priorityTag.parent) return currentTag.parent - priorityTag.parent;\n\n    if (!currentTag.position && priorityTag.position) return 1;\n    if (currentTag.position && !priorityTag.position) return -1;\n    if (currentTag.position && priorityTag.position) return currentTag.position - priorityTag.position;\n    return currentTag.id - priorityTag.id;\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['components/TerminalPost'];","import Component from \"flarum/common/Component\";\r\nimport craftBadges from \"../utils/craftBadges\";\r\nimport getPostImage from \"../helpers/getPostImage\";\r\nimport highlightHashtags from \"../helpers/highlightHashtags\";\r\nimport craftTags from \"../utils/craftTags\";\r\nimport humanTime from \"flarum/common/utils/humanTime\";\r\nimport icon from \"flarum/common/helpers/icon\";\r\nimport username from \"flarum/common/helpers/username\";\r\nimport Dropdown from \"flarum/common/components/Dropdown\";\r\nimport DiscussionControls from \"flarum/forum/utils/DiscussionControls\";\r\nimport Link from \"flarum/common/components/Link\";\r\nimport { truncate } from \"flarum/common/utils/string\";\r\nimport LastReplies from \"./LastReplies\";\r\nimport compareTags from \"../helpers/compareTags\";\r\nimport isValideImageUrl from \"../helpers/isValideImageUrl\";\r\nimport TerminalPost from 'flarum/components/TerminalPost';\r\n\r\nexport default class cardItem extends Component {\r\n\toninit(vnode) {\r\n\t\tsuper.oninit(vnode);\r\n\t\tthis.discussion = this.attrs.discussion;\r\n\t}\r\n\r\n\tview() {\r\n\t\tconst discussion = this.discussion;\r\n\t\tconst settings = {};\r\n\t\tfor (const key in app.forum.data.attributes) {\r\n\t\t\tif (key.startsWith('walsgitDiscussionCards')) {\r\n\t\t\t\tlet newKey = key.replace('walsgitDiscussionCards', '');\r\n\t\t\t\tnewKey = newKey.replace(/^./, newKey.charAt(0).toLowerCase());\r\n\t\t\t\tsettings[newKey] = app.forum.data.attributes[key];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/* Getting & setting relevant info for 3rd party Views extensions support: Flarumite and MichaelBelgium */\r\n\t\tconst viewsActivated = 'flarumite-simple-discussion-views' in flarum.extensions;\r\n\t\tconst isViewsSet = discussion.data.attributes.hasOwnProperty('views');\r\n\r\n\t\tconst mbViewsActivated = 'michaelbelgium-discussion-views' in flarum.extensions;\r\n\t\tconst isViewCountSet = discussion.data.attributes.hasOwnProperty('viewCount');\r\n\r\n\t\tconst viewsCount = viewsActivated && isViewsSet ? discussion.views() : mbViewsActivated && isViewCountSet ? discussion.viewCount() : NaN;\r\n\r\n\t\t/* Getting & setting relevant info for 3rd party Flarum Blog extension support */\r\n\t\tconst blogActivated = app.forum.data.attributes.hasOwnProperty('blogTags');\r\n\t\tconst blogSettings = {};\r\n\t\tconst postIsBlogType = discussion.data.relationships.hasOwnProperty('blogMeta');\r\n\t\tconst blogPost = {}\r\n\t\tif(blogActivated) {\r\n\t\t\tblogSettings.tags = app.forum.attribute('blogTags');\r\n\t\t\tblogSettings.defaultImage = app.forum.attribute('blogDefaultImage');\r\n\r\n\t\t\tif(postIsBlogType) {\r\n\t\t\t\tconst blogPostsData = discussion.store.data.blogMeta[discussion.data.relationships.blogMeta.data.id];\r\n\t\t\t\tif(isValideImageUrl(blogPostsData.attribute('featuredImage'))) {\r\n\t\t\t\t\tblogPost.featuredImage = blogPostsData.attribute('featuredImage');\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/* Getting & setting relevant info for 3rd party Repost extension */\r\n\t\tconst repostActivated = 'shebaoting-repost' in flarum.extensions;\r\n\t\tconst repostUrl = discussion.data.attributes.original_url || null;\r\n\r\n\t\tconst isTagPage = m.route.get().split('?')[0].startsWith('/t/');\r\n\t\tlet tagId;\r\n\t\tif (isTagPage) {\r\n\t\t\tconst slug = m.route.get().split('/t/')[1]?.split('?')[0];\r\n\t\t\ttagId = app.store.all('tags').find(t => t.slug() === slug).data.id;\r\n\t\t\tconst tag = app.store.all('tags').find(t => t.id() === tagId);\r\n\t\t\tconst tagSettings = tag ? JSON.parse(tag.data.attributes.walsgitDiscussionCardsTagSettings || '{}') : {};\r\n\t\t\tconst tagImage = tag ? tag.data.attributes.walsgitDiscussionCardsTagDefaultImage : null;\r\n\t\t\t\r\n\t\t\ttagSettings.defaultImage = tagImage;\r\n\t\t\t/* In case Flarum Blog Extension and useBlogImage are activated  */\r\n\t\t\tif(blogActivated && Number(settings.useBlogImages) === 1 && blogSettings.tags.includes(tagId)) {\r\n\t\t\t\ttagSettings.defaultImage = postIsBlogType && blogPost.featuredImage && isValideImageUrl(blogPost.featuredImage) ? blogPost.featuredImage : blogSettings.defaultImage;\r\n\t\t\t}\r\n\r\n\t\t\tfor (const key in tagSettings) {\r\n\t\t\t\tif (settings.hasOwnProperty(key) && tagSettings[key] !== settings[key] && tagSettings[key] !== null) {\r\n\t\t\t\t\tsettings[key] = tagSettings[key];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/* On the IndexPage (all discussions) checks which default image to show based on tag priority */\r\n\t\tconst isIndexPage = m.route.get().split('?')[0] === '/';\r\n\t\tif (isIndexPage) {\r\n\t\t\tconst tags = discussion.tags();\r\n\t\t\tfor (const key in tags) {\r\n\t\t\t\tconst tagId = tags[key].id();\r\n\t\t\t\tconst isChild = tags[key].isChild();\r\n\t\t\t\tconst parent = tags[key].data.hasOwnProperty('relationships') && tags[key].parent() ? tags[key].parent()['data'].id : null;\r\n\t\t\t\tconst position = tags[key].position();\r\n\r\n\t\t\t\tlet tagCustomImg = tags[key].attribute('walsgitDiscussionCardsTagDefaultImage');\r\n\t\t\t\t/* In case Flarum Blog Extension and useBlogImage are activated  */\r\n\t\t\t\tif(blogActivated && Number(settings.useBlogImages) === 1 && blogSettings.tags.includes(tagId)) {\r\n\t\t\t\t\ttagCustomImg = postIsBlogType && blogPost.featuredImage && isValideImageUrl(blogPost.featuredImage) ? blogPost.featuredImage : blogSettings.defaultImage;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst currentTag = { id: tagId, isChild, parent, position, tagCustomImg }\r\n\t\t\t\tlet priorityTag = null;\r\n\t\t\t\tif (!settings.allowedTags.includes(tagId) || tagCustomImg === null) continue;\t\t\t\t\t\r\n\r\n\t\t\t\tif (priorityTag === null || compareTags(currentTag, priorityTag) < 0) {\r\n\t\t\t\t\tpriorityTag = { id: tagId, isChild, parent, position, tagCustomImg };\r\n\t\t\t\t\tsettings.defaultImage = tagCustomImg;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tconst isRead = Number(settings.markReadCards) === 1 && discussion.isRead() && app.session.user ? \"read\" : \"\";\r\n\t\t\r\n\t\tconst attrs = {};\r\n\t\tattrs.className =\r\n\t\t\t\"wrapImg\" + (Number(settings.showAuthor) === 1 ? \" After\" : \"\");\r\n\t\tconst image = getPostImage(discussion.firstPost(), settings.defaultImage, postIsBlogType);\r\n\t\tconst media = image ? (\r\n\t\t\t<img\r\n\t\t\t\tsrc={image}\r\n\t\t\t\tclassName=\"previewCardImg\"\r\n\t\t\t\talt={discussion.title()}\r\n\t\t\t\tloading=\"lazy\"\r\n\t\t\t/>\r\n\t\t) : (\r\n\t\t\t<div className=\"imgStub\" />\r\n\t\t);\r\n\r\n\t\t/* Jump to the last relevant post (first unread or last post) */\r\n\t\tconst jumpTo = Math.min(discussion.lastPostNumber() ?? 0, (discussion.lastReadPostNumber() || 0) + 1);\r\n\r\n\t\t/* setting post counts & text */\r\n\t\tconst replyText = discussion.unreadCount() \r\n\t\t\t? app.translator.trans(\"walsgit_discussion_cards.forum.unreadReplies\", { count: discussion.unreadCount()} ) \r\n\t\t\t: app.translator.trans(\"walsgit_discussion_cards.forum.replies\", { count: discussion.replyCount() || \"0\"} );\r\n\r\n\t\treturn (\r\n\t\t\t<div\r\n\t\t\t\tkey={discussion.id()}\r\n\t\t\t\tdata-id={discussion.id()}\r\n\t\t\t\tdata-tag-id={isTagPage ? tagId : null}\r\n\t\t\t\tclassName={\r\n\t\t\t\t\t\"CardsListItem Card \" +\r\n\t\t\t\t\tisRead +\r\n\t\t\t\t\t(discussion.isHidden() ? \" Hidden\" : \"\")\r\n\t\t\t\t}\r\n\t\t\t>\r\n\t\t\t\t{DiscussionControls.controls(discussion, this).toArray().length\r\n\t\t\t\t\t? m(\r\n\t\t\t\t\t\t\tDropdown,\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\ticon: \"fas fa-ellipsis-v\",\r\n\t\t\t\t\t\t\t\tclassName: \"DiscussionListItem-controls\",\r\n\t\t\t\t\t\t\t\tbuttonClassName:\r\n\t\t\t\t\t\t\t\t\t\"Button Button--icon Button--flat Slidable-underneath Slidable-underneath--right\",\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tDiscussionControls.controls(\r\n\t\t\t\t\t\t\t\tdiscussion,\r\n\t\t\t\t\t\t\t\tthis\r\n\t\t\t\t\t\t\t).toArray()\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t: \"\"}\r\n\t\t\t\t<Link\r\n\t\t\t\t\thref={app.route.discussion(discussion, jumpTo)}\r\n\t\t\t\t\tclassName=\"cardLink\"\r\n\t\t\t\t>\r\n\t\t\t\t\t<div {...attrs}>\r\n\t\t\t\t\t\t{(isViewsSet || isViewCountSet) && (\r\n\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t{Number(settings.showViews) === 1 &&\r\n\t\t\t\t\t\t\t\t!isNaN(viewsCount) ? (\r\n\t\t\t\t\t\t\t\t\t<div className=\"imageLabel discussionViews\">\r\n\t\t\t\t\t\t\t\t\t\t{icon(\"fas fa-eye\", { className: \"labelIcon\" })}\r\n\t\t\t\t\t\t\t\t\t\t{viewsCount}\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t\"\"\r\n\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t\t{media}\r\n\r\n\t\t\t\t\t\t{Number(settings.showAuthor) === 1 ? (\r\n\t\t\t\t\t\t\t<div className=\"cardFoot\">\r\n\t\t\t\t\t\t\t\t<div className=\"Author\">\r\n\t\t\t\t\t\t\t\t\t{username(discussion.user())}\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div className=\"Date\">\r\n\t\t\t\t\t\t\t\t\t{humanTime(discussion.createdAt())}\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\"\"\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t{/* 徽章 + 标签 + 标题（与ListItem相同的布局） */}\r\n\t\t\t\t\t<div className=\"cardHeaderRow\">\r\n\t\t\t\t\t\t{/* 徽章 */}\r\n\t\t\t\t\t\t{Number(settings.showBadges) === 1 && craftBadges(discussion.badges().toArray())}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t{/* 标签 */}\r\n\t\t\t\t\t\t<div className=\"cardTags\">\r\n\t\t\t\t\t\t\t{craftTags(discussion.tags())}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t{/* 标题 */}\r\n\t\t\t\t\t\t<div className=\"cardTitle\">\r\n\t\t\t\t\t\t\t<h2 title={discussion.title()} className=\"title\">\r\n\t\t\t\t\t\t\t\t{Number(settings.allowRepostLinks) === 1 && repostActivated && repostUrl ? \r\n\t\t\t\t\t\t\t\t\t<a href={repostUrl} onclick={(e) => e.stopPropagation()}>{truncate(discussion.title(), 80)}</a> : \r\n\t\t\t\t\t\t\t\t\ttruncate(discussion.title(), 80)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t</h2>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t{Number(settings.previewText) === 1 && discussion.firstPost() ? (\r\n\t\t\t\t\t\t<div className=\"previewPost\">\r\n\t\t\t\t\t\t\t{m.trust(highlightHashtags(\r\n\t\t\t\t\t\t\t\tblogActivated && Number(settings.useBlogSummary) === 1 && discussion.data.relationships.hasOwnProperty('blogMeta') && discussion.blogMeta().summary() !== ''\r\n\t\t\t\t\t\t\t\t\t? truncate(discussion.blogMeta().summary(), 300)\r\n\t\t\t\t\t\t\t\t\t: truncate(discussion.firstPost().contentPlain(), 300)\r\n\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\"\"\r\n\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t{Number(settings.showLastPostInfo) === 1 && discussion.firstPost() ? (\r\n\t\t\t\t\t\t<div className=\"terminalPost\">\r\n\t\t\t\t\t\t<TerminalPost discussion={discussion} lastPost={discussion.lastPostNumber()} />\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t) : (\r\n\t\t\t\t\t\t''\r\n\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t{Number(settings.showReplies) === 1 ? (\r\n\t\t\t\t\t\t<div className=\"cardSpacer\">\r\n\t\t\t\t\t\t\t<Link\r\n\t\t\t\t\t\t\t\tclassName=\"Replies\"\r\n\t\t\t\t\t\t\t\thref={app.route.discussion(\r\n\t\t\t\t\t\t\t\t\tdiscussion,\r\n\t\t\t\t\t\t\t\t\tdiscussion.lastPostNumber()\r\n\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t<div className=\"Left\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"Avatars\">\r\n\t\t\t\t\t\t\t\t\t\t{m(LastReplies, {\r\n\t\t\t\t\t\t\t\t\t\t\tdiscussion: discussion,\r\n\t\t\t\t\t\t\t\t\t\t})}\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"Repcount\">\r\n\t\t\t\t\t\t\t\t\t\t{replyText}\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div className=\"Arrow\">\r\n\t\t\t\t\t\t\t\t\t{icon(\"fas fa-angle-right\")}\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</Link>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\"\"\r\n\t\t\t\t\t)}\r\n\t\t\t\t</Link>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}\r\n","import isValideImageUrl from \"./isValideImageUrl\";\n\nexport default function getPostImage(post, image, isblogPost = false, key = 1) {\n\n  const regex = /<img(?!.*?class=\"emoji\").*?src=[\\'\"](.*?)[\\'\"].*?>|background(?:-image)?:\\s*url\\(['\"]?(.*?)['\"]?\\)/i;\n\n  if(isblogPost && isValideImageUrl(image)) {\n    return image;\n  }\n\n  const assetImage = app.forum.attribute(\"baseUrl\") + \"/assets/\" + image;\n\n  if (post) {\n    const src = regex.exec(post.contentHtml());\n    if (typeof key === \"number\" && key > 0) {\n      return (src) ? (src[1] || src[2]) : (image ? assetImage : null);\n    } else if (key === '~') {\n      return src;\n    } else {\n      return null;\n    }\n  }\n\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/abbreviateNumber'];","import Component from \"flarum/common/Component\";\r\nimport craftBadges from \"../utils/craftBadges\";\r\nimport getPostImage from \"../helpers/getPostImage\";\r\nimport getPostImages from \"../helpers/getPostImages\";\r\nimport highlightHashtags from \"../helpers/highlightHashtags\";\r\nimport craftTags from \"../utils/craftTags\";\r\nimport humanTime from 'flarum/common/utils/humanTime';\r\nimport icon from 'flarum/common/helpers/icon';\r\nimport username from 'flarum/common/helpers/username';\r\nimport Dropdown from 'flarum/common/components/Dropdown';\r\nimport DiscussionControls from 'flarum/forum/utils/DiscussionControls';\r\nimport Link from 'flarum/common/components/Link';\r\nimport {truncate} from 'flarum/common/utils/string';\r\nimport LastReplies from './LastReplies';\r\nimport compareTags from \"../helpers/compareTags\";\r\nimport isValideImageUrl from \"../helpers/isValideImageUrl\";\r\nimport abbreviateNumber from 'flarum/common/utils/abbreviateNumber';\r\nimport TerminalPost from 'flarum/components/TerminalPost';\r\n\r\n\r\nexport default class listItem extends Component {\r\n\r\n  oninit(vnode) {\r\n    super.oninit(vnode);\r\n  }\r\n\r\n  view() {\r\n    const discussion = this.attrs.discussion;\r\n    const settings = {};\r\n    for (const key in app.forum.data.attributes) {\r\n\t\t\tif (key.startsWith('walsgitDiscussionCards')) {\r\n\t\t\t\tlet newKey = key.replace('walsgitDiscussionCards', '');\r\n\t\t\t\tnewKey = newKey.replace(/^./, newKey.charAt(0).toLowerCase());\r\n\t\t\t\tsettings[newKey] = app.forum.data.attributes[key];\r\n\t\t\t}\r\n\t\t}\r\n\r\n    /* Getting & setting relevant info for 3rd party Views extensions support: Flarumite and MichaelBelgium */\r\n\t\tconst viewsActivated = 'flarumite-simple-discussion-views' in flarum.extensions;\r\n\t\tconst isViewsSet = discussion.data.attributes.hasOwnProperty('views');\r\n\r\n\t\tconst mbViewsActivated = 'michaelbelgium-discussion-views' in flarum.extensions;\r\n\t\tconst isViewCountSet = discussion.data.attributes.hasOwnProperty('viewCount');\r\n\r\n\t\tconst viewsCount = viewsActivated && isViewsSet ? discussion.views() : mbViewsActivated && isViewCountSet ? discussion.viewCount() : NaN;\r\n\r\n    /* Getting & setting relevant info for 3rd party Flarum Blog support */\r\n\t\tconst blogActivated = app.forum.data.attributes.hasOwnProperty('blogTags');\r\n\t\tconst blogSettings = {};\r\n\t\tconst postIsBlogType = discussion.data.relationships.hasOwnProperty('blogMeta');\r\n\t\tconst blogPost = {}\r\n\t\tif(blogActivated) {\r\n\t\t\tblogSettings.tags = app.forum.attribute('blogTags');\r\n\t\t\tblogSettings.defaultImage = app.forum.attribute('blogDefaultImage');\r\n\r\n\t\t\tif(postIsBlogType) {\r\n\t\t\t\tconst blogPostsData = discussion.store.data.blogMeta[discussion.data.relationships.blogMeta.data.id];\r\n\t\t\t\tif(isValideImageUrl(blogPostsData.attribute('featuredImage'))) {\r\n\t\t\t\t\tblogPost.featuredImage = blogPostsData.attribute('featuredImage');\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n    /* Getting & setting relevant info for 3rd party Repost extension */\r\n    const repostActivated = 'shebaoting-repost' in flarum.extensions;\r\n    const repostUrl = discussion.data.attributes.original_url || null;\r\n\r\n    const isTagPage = m.route.get().split('?')[0].startsWith('/t/');\r\n\t\tif (isTagPage) {\r\n      const slug = m.route.get().split('/t/')[1]?.split('?')[0];\r\n      const tagId = app.store.all('tags').find(t => t.slug() === slug).data.id;\r\n      const tag = app.store.all('tags').find(t => t.id() === tagId);\r\n      const tagSettings = tag ? JSON.parse(tag.data.attributes.walsgitDiscussionCardsTagSettings || '{}') : {};\r\n      const tagImage = tag ? tag.data.attributes.walsgitDiscussionCardsTagDefaultImage : null;\r\n      \r\n      tagSettings.defaultImage = tagImage;\r\n      /* In case Flarum Blog Extension and useBlogImage are activated  */\r\n      if(blogActivated && Number(settings.useBlogImages) === 1 && blogSettings.tags.includes(tagId)) {\r\n\t\t\t\ttagSettings.defaultImage = postIsBlogType && blogPost.featuredImage && isValideImageUrl(blogPost.featuredImage) ? blogPost.featuredImage : blogSettings.defaultImage;\r\n\t\t\t}\r\n\r\n      for (const key in tagSettings) {\r\n        if (settings.hasOwnProperty(key) && tagSettings[key] !== settings[key] && tagSettings[key] !== null) {\r\n          settings[key] = tagSettings[key];\r\n        }\r\n      }\r\n    }\r\n\r\n    /* On the IndexPage (all discussions) checks which default image to show based on tag priority */\r\n\t\tconst isIndexPage = m.route.get().split('?')[0] === '/';\r\n\t\tif (isIndexPage) {\r\n\t\t\tconst tags = discussion.tags();\r\n\t\t\tfor (const key in tags) {\r\n\t\t\t\tconst tagId = tags[key].id();\r\n\t\t\t\tconst isChild = tags[key].isChild();\r\n\t\t\t\tconst parent = tags[key].data.hasOwnProperty('relationships') && tags[key].parent() ? tags[key].parent()['data'].id : null;\r\n\t\t\t\tconst position = tags[key].position();\r\n\r\n\t\t\t\tlet tagCustomImg = tags[key].attribute('walsgitDiscussionCardsTagDefaultImage');\r\n        /* In case Flarum Blog Extension and useBlogImage are activated  */\r\n\t\t\t\tif(blogActivated && Number(settings.useBlogImages) === 1 && blogSettings.tags.includes(tagId)) {\r\n\t\t\t\t\ttagCustomImg = postIsBlogType && blogPost.featuredImage && isValideImageUrl(blogPost.featuredImage) ? blogPost.featuredImage : blogSettings.defaultImage;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst currentTag = { id: tagId, isChild, parent, position, tagCustomImg }\r\n\t\t\t\tlet priorityTag = null;\r\n\t\t\t\tif (!settings.allowedTags.includes(tagId) || tagCustomImg === null)\tcontinue;\r\n\r\n\t\t\t\tif (priorityTag === null || compareTags(currentTag, priorityTag) < 0) {\r\n\t\t\t\t\tpriorityTag = { id: tagId, isChild, parent, position, tagCustomImg };\r\n\t\t\t\t\tsettings.defaultImage = tagCustomImg;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n    const isRead = Number(settings.markReadCards) === 1 && (discussion.isRead() && app.session.user) ? 'read' : '';\r\n    \r\n    // 获取列表卡片最大图片数量设置（默认为3）\r\n    const maxListImages = Number(settings.maxListImages) || 3;\r\n    \r\n    // 获取最后一个标签的颜色用于左侧色条\r\n    const tags = discussion.tags();\r\n    const lastTag = tags && tags.length > 0 ? tags[tags.length - 1] : null;\r\n    const tagColor = lastTag ? lastTag.color() : '#ddd';\r\n    \r\n    // 获取多张图片\r\n    const images = getPostImages(discussion.firstPost(), settings.defaultImage, postIsBlogType, maxListImages);\r\n    const hasImages = images.length > 0;\r\n\r\n    /* Jump to the last relevant post (first unread or last post) */\r\n    const jumpTo = Math.min(discussion.lastPostNumber() ?? 0, (discussion.lastReadPostNumber() || 0) + 1);\r\n\r\n    /* setting post counts & text */\r\n\t\tconst replyText = discussion.unreadCount() \r\n\t\t\t? app.translator.trans(\"walsgit_discussion_cards.forum.unreadReplies\", { count: discussion.unreadCount()} ) \r\n\t\t\t: app.translator.trans(\"walsgit_discussion_cards.forum.replies\", { count: discussion.replyCount() || \"0\"} );\r\n    const postCount = discussion.unreadCount() ? discussion.unreadCount() + \"*\" : discussion.replyCount();\r\n\r\n    return (\r\n      <div key={discussion.id()}\r\n          data-id={discussion.id()}\r\n          className={\"CardsListItem List \" + isRead + (discussion.isHidden() ? \" Hidden\" : \"\")}\r\n          style={`--tag-color: ${tagColor}`}>\r\n        {DiscussionControls.controls(discussion, this).toArray().length\r\n          ? m(Dropdown, {\r\n            icon: 'fas fa-ellipsis-v',\r\n            className: 'DiscussionListItem-controls',\r\n            buttonClassName: 'Button Button--icon Button--flat Slidable-underneath Slidable-underneath--right',\r\n          }, DiscussionControls.controls(discussion, this).toArray())\r\n          : ''}\r\n        <Link href={app.route.discussion(discussion, jumpTo)}\r\n              className=\"cardLink\">\r\n\r\n          <div className=\"listCardContent\">\r\n            {/* 顶部：徽章 + 标签 + 标题（智能一行布局，空间不足时标题自动换行） */}\r\n            <div className=\"listCardHeader\">\r\n              <div className=\"listHeaderRow\">\r\n                {/* 徽章 */}\r\n                {Number(settings.showBadges) === 1 && craftBadges(discussion.badges().toArray())}\r\n                \r\n                {/* 标签 */}\r\n                <div className=\"cardTags\">{craftTags(discussion.tags())}</div>\r\n                \r\n                {/* 标题 */}\r\n                <div className=\"cardTitle\">\r\n                  <h2 title={discussion.title()} className=\"title\">\r\n                    {Number(settings.allowRepostLinks) === 1 && repostActivated && repostUrl ? \r\n                      <a href={repostUrl} onclick={(e) => e.stopPropagation()}>{truncate(discussion.title(), 80)}</a> : \r\n                      truncate(discussion.title(), 80)\r\n                    }\r\n                  </h2>\r\n                  {app.screen() !== 'phone' && Number(settings.showReplies) === 1 && Number(settings.showRepliesOnRight) === 1 ?\r\n                    <div className=\"DiscussionListItem-count\">\r\n                      <span aria-hidden=\"true\">{abbreviateNumber(postCount)}</span>\r\n                      <span className=\"visually-hidden\">\r\n                        {app.translator.trans('core.forum.discussion_list.unread_replies_a11y_label', { count: discussion.replyCount() })}\r\n                      </span>\r\n                    </div>\r\n                  : ''}\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* 预览文本 */}\r\n            {Number(settings.previewText) === 1 && discussion.firstPost() ? (\r\n              <div className=\"previewPost\">\r\n                {m.trust(highlightHashtags(\r\n                  blogActivated && Number(settings.useBlogSummary) === 1 && discussion.data.relationships.hasOwnProperty('blogMeta') && discussion.blogMeta().summary() !== ''\r\n                    ? truncate(discussion.blogMeta().summary(), 300)\r\n                    : truncate(discussion.firstPost().contentPlain(), 300)\r\n                ))}\r\n              </div>\r\n            ) : ''}\r\n\r\n            {/* 图片网格 - 在内容下方横向显示 */}\r\n            {hasImages && (\r\n              <div className=\"listImagesRow\">\r\n                {images.map((img, index) => (\r\n                  <img \r\n                    key={index}\r\n                    src={img}\r\n                    className=\"listImageThumb\"\r\n                    alt={discussion.title()}\r\n                    loading=\"lazy\"\r\n                  />\r\n                ))}\r\n              </div>\r\n            )}\r\n\r\n            {/* 作者、回复数和时间信息 */}\r\n            {Number(settings.showAuthor) === 1 && (\r\n              <div className=\"listCardFooter\">\r\n                <div className=\"listMetaInfo\">\r\n                  <span className=\"listAuthor\">{username(discussion.user())}</span>\r\n                  \r\n                  {Number(settings.showReplies) === 1 && (\r\n                    <span className=\"listReplies\">\r\n                      {icon('fas fa-comment', {className: 'listIcon'})}\r\n                      <span>{postCount}</span>\r\n                    </span>\r\n                  )}\r\n                  \r\n                  <span className=\"listDate\">{humanTime(discussion.createdAt())}</span>\r\n                </div>\r\n                \r\n                {(isViewsSet || isViewCountSet) && Number(settings.showViews) === 1 && !isNaN(viewsCount) && (\r\n                  <div className=\"listViews\">\r\n                    {icon('fas fa-eye', {className: 'listIcon'})}\r\n                    <span>{viewsCount}</span>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            )}\r\n              \r\n            {Number(settings.showLastPostInfo) === 1 && discussion.firstPost() ? (\r\n              <div className=\"terminalPost\">\r\n                <TerminalPost discussion={discussion} lastPost={discussion.lastPostNumber()} />\r\n              </div>\r\n            ) : ''}\r\n          </div>\r\n        </Link>\r\n      </div>\r\n    );\r\n\r\n  }\r\n\r\n}\r\n","import isValideImageUrl from \"./isValideImageUrl\";\r\n\r\n/**\r\n * 从帖子内容中提取多张图片\r\n * @param {Object} post - 帖子对象\r\n * @param {string} defaultImage - 默认图片路径\r\n * @param {boolean} isBlogPost - 是否为博客帖子\r\n * @param {number} maxImages - 最多提取图片数量（0-5）\r\n * @returns {Array} 图片URL数组\r\n */\r\nexport default function getPostImages(post, defaultImage, isBlogPost = false, maxImages = 3) {\r\n  const images = [];\r\n  \r\n  // 如果是博客帖子且有有效的默认图片，优先使用\r\n  if (isBlogPost && isValideImageUrl(defaultImage)) {\r\n    images.push(defaultImage);\r\n    if (maxImages === 1) return images;\r\n  }\r\n  \r\n  // 如果没有帖子内容，返回默认图片或空数组\r\n  if (!post) {\r\n    if (defaultImage && !isBlogPost) {\r\n      const assetImage = app.forum.attribute(\"baseUrl\") + \"/assets/\" + defaultImage;\r\n      images.push(assetImage);\r\n    }\r\n    return images;\r\n  }\r\n  \r\n  // 正则表达式匹配所有图片（排除emoji）\r\n  const regex = /<img(?!.*?class=\"emoji\").*?src=[\\'\"](.*?)[\\'\"].*?>/gi;\r\n  const content = post.contentHtml();\r\n  \r\n  let match;\r\n  let count = isBlogPost && images.length > 0 ? 1 : 0; // 如果已经添加了博客图片，从1开始计数\r\n  \r\n  // 提取所有图片URL\r\n  while ((match = regex.exec(content)) !== null && count < maxImages) {\r\n    const imageUrl = match[1];\r\n    if (imageUrl && !images.includes(imageUrl)) {\r\n      images.push(imageUrl);\r\n      count++;\r\n    }\r\n  }\r\n  \r\n  // 如果没有找到图片且有默认图片，添加默认图片\r\n  if (images.length === 0 && defaultImage) {\r\n    const assetImage = app.forum.attribute(\"baseUrl\") + \"/assets/\" + defaultImage;\r\n    images.push(assetImage);\r\n  }\r\n  \r\n  return images;\r\n}\r\n","export default function checkOverflowingTags() {\n    const cardListItemsOnPrimary = document.querySelectorAll(\".CardsListItem.Card .cardLink\");\n    const cardListItems = document.querySelectorAll(\".cardGrid .colSpan-2\");\n\n    const toggleOverflowClass = function(cardTags, cardListItem) {\n        if (!cardTags) return;\n\n        if (cardTags.scrollWidth > cardListItem.clientWidth - 30) { // -30 to account for the 15px + 15px margins on .cardTags\n        cardTags.classList.add(\"overflowing\");\n        } else {\n        cardTags.classList.remove(\"overflowing\");\n        }\n    }\n\n    cardListItemsOnPrimary.forEach(cardListItem => {\n        const cardTags = cardListItem.querySelector(\".cardTags\");\n\n        toggleOverflowClass(cardTags, cardListItem);\n    });\n\n    cardListItems.forEach(cardListItem => {\n        const cardTags = cardListItem.querySelector(\".flexBox .cardTags\");\n\n        toggleOverflowClass(cardTags, cardListItem);\n    });\n}","import CardItem from './components/CardItem';\nimport ListItem from './components/ListItem';\nimport LastReplies from './components/LastReplies';\nimport craftTags from \"./utils/craftTags\";\nimport craftBadges from \"./utils/craftBadges\";\n\nexport default {\n  'walsgit/discussion/cards/components/CardItem': CardItem,\n  'walsgit/discussion/cards/components/ListItem': ListItem,\n  'walsgit/discussion/cards/components/LastReplies': LastReplies,\n  'walsgit/discussion/cards/utils/craftTags': craftTags,\n  'walsgit/discussion/cards/utils/craftBadges': craftBadges,\n};\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core;","import app from 'flarum/app';\r\nimport {extend, override} from 'flarum/extend';\r\nimport DiscussionList from 'flarum/forum/components/DiscussionList';\r\nimport DiscussionListState from 'flarum/forum/states/DiscussionListState';\r\nimport IndexPage from 'flarum/forum/components/IndexPage';\r\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\r\nimport Placeholder from 'flarum/common/components/Placeholder';\r\nimport Button from 'flarum/common/components/Button';\r\nimport CardItem from './components/CardItem';\r\nimport ListItem from './components/ListItem';\r\nimport checkOverflowingTags from './helpers/checkOverflowingTags';\r\n\r\napp.initializers.add('walsgit/discussion/cards', () => {\r\n\r\n  extend(DiscussionList.prototype, 'oncreate', checkOverflowingTags);\r\n  extend(DiscussionList.prototype, 'onupdate', checkOverflowingTags);\r\n\r\n  extend(DiscussionListState.prototype, 'requestParams', function (params) {\r\n    if (app.current.matches(IndexPage)) {\r\n      params.include.push(['firstPost', 'posts', 'posts.user']);\r\n    }\r\n  });\r\n\r\n  override(DiscussionList.prototype, 'view', function (original) {\r\n    const settings = {};\r\n    for (const key in app.forum.data.attributes) {\r\n      if (key.startsWith('walsgitDiscussionCards')) {\r\n        let newKey = key.replace('walsgitDiscussionCards', '');\r\n        newKey = newKey.replace(/^./, newKey.charAt(0).toLowerCase());\r\n        settings[newKey] = app.forum.data.attributes[key];\r\n      }\r\n    }\r\n    const state = this.attrs.state;\r\n    const params = state.getParams();\r\n    let loading;\r\n    if (state.isInitialLoading() || state.isLoadingNext()) {\r\n      loading = <LoadingIndicator/>;\r\n    } else if (state.hasNext()) {\r\n      loading = Button.component(\r\n        {\r\n          className: 'Button',\r\n          onclick: state.loadNext.bind(state),\r\n        },\r\n        app.translator.trans('core.forum.discussion_list.load_more_button')\r\n      );\r\n    }\r\n    if (state.isEmpty()) {\r\n      const text = app.translator.trans('core.forum.discussion_list.empty_text');\r\n      return <div className=\"DiscussionList\">{m(Placeholder, {text})}</div>;\r\n    }\r\n    \r\n    // 检查当前页面类型和标签\r\n    const currentRoute = m.route.get().split('?')[0];\r\n    const isIndexPage = app.current.matches(IndexPage);\r\n    const isTagPage = currentRoute.includes('/t/') && params.tags;\r\n    \r\n    let tag = null;\r\n    let shouldShowCards = false;\r\n    \r\n    // 解析允许的标签列表\r\n    let allowedTags = [];\r\n    try {\r\n      allowedTags = settings.allowedTags ? JSON.parse(settings.allowedTags) : [];\r\n    } catch (e) {\r\n      allowedTags = [];\r\n    }\r\n    \r\n    if (isTagPage && params.tags) {\r\n      // 标签页面逻辑\r\n      const tagObj = app.store.all('tags').find(t => t.slug() === params.tags);\r\n      if (tagObj) {\r\n        tag = tagObj.data.id;\r\n        // 检查当前标签是否在允许列表中\r\n        shouldShowCards = allowedTags.includes(tag);\r\n        \r\n        // 应用标签特定设置\r\n        const tagSettingsRaw = tagObj.data.attributes.walsgitDiscussionCardsTagSettings;\r\n        if (tagSettingsRaw) {\r\n          try {\r\n            const tagSettings = JSON.parse(tagSettingsRaw);\r\n            for (const key in tagSettings) {\r\n              if (settings.hasOwnProperty(key) && tagSettings[key] !== undefined) {\r\n                settings[key] = tagSettings[key];\r\n              }\r\n            }\r\n          } catch (e) {\r\n            // 忽略标签设置解析错误\r\n          }\r\n        }\r\n      }\r\n    } else if (isIndexPage && !params.tags) {\r\n      // 首页逻辑（全部讨论）\r\n      shouldShowCards = Number(settings.onIndexPage) === 1;\r\n    }\r\n    \r\n    if (shouldShowCards) {\r\n      return (\r\n        <div className={'DiscussionList' + (state.isSearchResults() ? ' DiscussionList--searchResults' : '')}>\r\n          <div class=\"DiscussionList-discussions flexCard\">\r\n            {state.getPages().map((pg, o) => {\r\n              return pg.items.map((discussion, i) => {\r\n                return (i < Number(settings.primaryCards) && o === 0)\r\n                  ? m(CardItem, {discussion: discussion})\r\n                  : m(ListItem, {discussion: discussion})\r\n              });\r\n            })}\r\n          </div>\r\n          <div className=\"DiscussionList-loadMore\">{loading}</div>\r\n        </div>\r\n      );\r\n    } else {\r\n      return original();\r\n    }\r\n  })\r\n}, -1);\r\n\r\n\r\n// Expose compat API\r\nimport extCompat from './compat';\r\nimport {compat} from '@flarum/core/forum';\r\n\r\nObject.assign(compat, extCompat);\r\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","flarum","core","compat","_setPrototypeOf","t","e","setPrototypeOf","bind","__proto__","_inheritsLoose","create","constructor","craftBadges","badges","length","m","map","badge","Tooltip","text","attrs","label","position","type","icon","isValideImageUrl","url","parsedUrl","startsWith","URL","_unused","extension","pathname","split","pop","toLowerCase","includes","highlightHashtags","result","replace","craftTags","tags","sortTags","tag","Link","className","style","backgroundColor","color","href","app","route","slug","name","LastReplies","_Component","apply","arguments","_proto","oninit","vnode","this","discussion","view","posts","splice","filter","post","isHidden","number","contentType","sort","b","createdAt","user","i","self","indexOf","reverse","avatar","Component","compareTags","currentTag","priorityTag","isChild","parent","id","cardItem","_discussion$lastPostN","settings","forum","data","attributes","newKey","charAt","viewsActivated","extensions","isViewsSet","mbViewsActivated","isViewCountSet","viewsCount","views","viewCount","NaN","blogActivated","blogSettings","postIsBlogType","relationships","blogPost","attribute","defaultImage","blogPostsData","store","blogMeta","featuredImage","tagId","repostActivated","repostUrl","original_url","isTagPage","_m$route$get$split$","all","find","tagSettings","JSON","parse","walsgitDiscussionCardsTagSettings","tagImage","walsgitDiscussionCardsTagDefaultImage","Number","useBlogImages","tagCustomImg","allowedTags","isRead","markReadCards","session","showAuthor","image","isblogPost","assetImage","src","exec","contentHtml","getPostImage","firstPost","media","alt","title","loading","jumpTo","Math","min","lastPostNumber","lastReadPostNumber","replyText","unreadCount","translator","trans","count","replyCount","DiscussionControls","toArray","Dropdown","buttonClassName","'['","showViews","isNaN","username","humanTime","showBadges","allowRepostLinks","onclick","stopPropagation","truncate","previewText","trust","useBlogSummary","summary","contentPlain","showLastPostInfo","TerminalPost","lastPost","showReplies","listItem","maxListImages","lastTag","tagColor","images","isBlogPost","maxImages","push","match","regex","content","imageUrl","getPostImages","hasImages","postCount","screen","showRepliesOnRight","abbreviateNumber","img","index","checkOverflowingTags","cardListItemsOnPrimary","document","querySelectorAll","cardListItems","toggleOverflowClass","cardTags","cardListItem","scrollWidth","clientWidth","classList","add","remove","forEach","querySelector","CardItem","ListItem","extend","DiscussionList","DiscussionListState","params","matches","IndexPage","include","override","original","state","getParams","isInitialLoading","isLoadingNext","LoadingIndicator","hasNext","Button","loadNext","isEmpty","Placeholder","currentRoute","isIndexPage","shouldShowCards","tagObj","tagSettingsRaw","undefined","onIndexPage","isSearchResults","class","getPages","pg","items","primaryCards","assign","extCompat"],"sourceRoot":""}